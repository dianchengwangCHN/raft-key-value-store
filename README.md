# raft-key-value-store

This is the course project of MIT 6.824 Distributed Systems. This project is a distributed key-value store based on the **Raft** consensus algorithm developed in **GoLang**. It is implemented to support concurrent requests utilizing **Mutex**, **Channel**, and **Goroutine**. It is tested under a simulated environment, which covers the circumstances such as network loss, network partition, and partial cluster down.

## Lab 2: Raft Consensus Algorithm

- [x] Leader Election
- [x] Log Replication
- [x] Log Persistence

Passed all the test cases of Lab 2. Test result is shown as below:

```
Test (2A): initial election ...
labgob warning: Decoding into a non-default variable/field ConflictIndex may not work
  ... Passed --   3.0  3   64    0
Test (2A): election after network failure ...
  ... Passed --   4.6  3  105    0
Test (2B): basic agreement ...
  ... Passed --   0.8  5   32    3
Test (2B): agreement despite follower disconnection ...
  ... Passed --   5.7  3  110    8
Test (2B): no agreement if too many followers disconnect ...
  ... Passed --   3.7  5  172    4
Test (2B): concurrent Start()s ...
  ... Passed --   0.6  3   26    6
Test (2B): rejoin of partitioned leader ...
  ... Passed --   5.2  3  165    4
Test (2B): leader backs up quickly over incorrect follower logs ...
  ... Passed --  15.0  5 2756  102
Test (2B): RPC counts aren't too high ...
  ... Passed --   2.0  3   41   12
Test (2C): basic persistence ...
  ... Passed --  13.4  3  271    6
Test (2C): more persistence ...
  ... Passed --  20.8  5 1159   16
Test (2C): partitioned leader and one follower crash, leader restarts ...
  ... Passed --   1.4  3   35    4
Test (2C): Figure 8 ...
  ... Passed --  35.4  5 1024   33
Test (2C): unreliable agreement ...
  ... Passed --   1.7  5 1120  246
Test (2C): Figure 8 (unreliable) ...
  ... Passed --  36.0  5 15715  576
Test (2C): churn ...
  ... Passed --  16.1  5 11763 2096
Test (2C): unreliable churn ...
  ... Passed --  16.1  5 7956 1519
PASS
ok  	github.com/dianchengwangCHN/raft-key-value-store/raft	181.813s
```

## Lab 3: Key-Value Service

- [x] Client Interface
- [x] Log Compaction

**Note**: A tricky problem in Lab 3 is directly `append()` a part of old log to the new log will not eliminate the reference to the underlying array of old log. Thus, be careful to copy the part of the old slice first and then `append()` it to the new slice.

Passed all test cases of Lab 3. Test result is shown as below:

```
Test: one client (3A) ...
labgob warning: Decoding into a non-default variable/field LeaderID may not work
  ... Passed --  15.0  5 20459 2608
Test: many clients (3A) ...
  ... Passed --  15.2  5 27785 2866
Test: unreliable net, many clients (3A) ...
  ... Passed --  16.4  5 12629 1759
Test: concurrent append to same key, unreliable (3A) ...
  ... Passed --   0.5  3   227   52
Test: progress in majority (3A) ...
  ... Passed --   0.7  5    73    2
Test: no progress in minority (3A) ...
  ... Passed --   1.0  5   247    3
Test: completion after heal (3A) ...
  ... Passed --   1.0  5    64    3
Test: partitions, one client (3A) ...
  ... Passed --  22.6  5 52561 2252
Test: partitions, many clients (3A) ...
  ... Passed --  22.7  5 105574 2377
Test: restarts, one client (3A) ...
  ... Passed --  19.7  5 42283 2945
Test: restarts, many clients (3A) ...
  ... Passed --  20.1  5 57274 2886
Test: unreliable net, restarts, many clients (3A) ...
  ... Passed --  21.8  5 13920 1627
Test: restarts, partitions, many clients (3A) ...
  ... Passed --  27.2  5 97144 2511
Test: unreliable net, restarts, partitions, many clients (3A) ...
  ... Passed --  28.2  5 21945 1018
Test: unreliable net, restarts, partitions, many clients, linearizability checks (3A) ...
  ... Passed --  25.9  7 53822 1547
Test: InstallSnapshot RPC (3B) ...
  ... Passed --   5.1  3 18556   63
Test: snapshot size is reasonable (3B) ...
  ... Passed --   0.4  3  2784  800
Test: restarts, snapshots, one client (3B) ...
  ... Passed --  20.0  5 193637 24113
Test: restarts, snapshots, many clients (3B) ...
  ... Passed --  19.8  5 182312 22930
Test: unreliable net, snapshots, many clients (3B) ...
  ... Passed --  16.2  5 11963 1262
Test: unreliable net, restarts, snapshots, many clients (3B) ...
  ... Passed --  23.3  5 15475 1432
Test: unreliable net, restarts, partitions, snapshots, many clients (3B) ...
  ... Passed --  28.4  5  9661  344
Test: unreliable net, restarts, partitions, snapshots, many clients, linearizability checks (3B) ...
  ... Passed --  25.8  7 32655  572
PASS
ok  	github.com/dianchengwangCHN/raft-key-value-store/kvraft	377.669s
```
